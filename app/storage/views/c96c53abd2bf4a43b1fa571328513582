
<?php $__env->startSection('content'); ?>
<div class="edit" ng-app="app">
	<div class="row">
		<div class="col col-md-12">
			<?php echo $__env->make('_helpers.breadcrumbs', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
			<?php if(Auth::user()->id == $user->id): ?>
				<h1>Edit Profile</h1>
			<?php else: ?>
		    	<h1>Edit <?php echo $user->first_name; ?> <?php echo $user->last_name; ?></h1>
		    <?php endif; ?>
		</div>
	</div>
	<div class="row" ng-controller="UserController">
		<div class="col col-lg-3 col-md-4 col-sm-6">
		    <?php echo Form::model($user, array('route' => array('users.update', $user->id), 'method' => 'PUT')); ?>

		
		    <div class="form-group">
		        <?php echo Form::label('first_name', 'First Name'); ?>

		        <?php echo Form::text('first_name', null, array('class' => 'form-control')); ?>

		    </div>
		    
		    <div class="form-group">
		        <?php echo Form::label('last_name', 'Last Name'); ?>

		        <?php echo Form::text('last_name', null, array('class' => 'form-control')); ?>

		    </div>
		    
		    <div class="form-group">
		        <?php echo Form::label('public_id', 'Public Id'); ?>

		        <?php echo Form::text('public_id', null, array('class' => 'form-control')); ?>

		    </div>
		    
		    <div class="form-group">
		        <?php echo Form::label('email', 'Email'); ?>

		        <?php echo Form::text('email', null, array('class' => 'form-control')); ?>

		    </div>
		    
		    <div class="form-group">
		        <?php echo Form::label('password', 'New Password'); ?>

		        <?php echo Form::password('password', array('class' => 'form-control')); ?>

		    </div>
		    
		    <div class="form-group">
		        <?php echo Form::label('password_confirm', 'Confirm New Password'); ?>

		        <?php echo Form::password('password_confirmation', array('class' => 'form-control')); ?>

		    </div>
		    
		    <div class="form-group">
	    		<?php echo Form::label('gender', 'Gender'); ?><br>
	    		<?php echo Form::select('gender', array(
			    	'M' => 'Male',
			    	'F' => 'Female',
			    ), null, array('class' => 'selectpicker')); ?>

		    </div>
		    
		    <!-- <div class="form-group">
		        <?php echo Form::label('key', 'Key'); ?>

		        <?php echo Form::text('key', null, array('class' => 'form-control')); ?>

		    </div> -->
		   
		    <div class="form-group">
		        <?php echo Form::label('dob', 'Date of Birth'); ?>

		        <?php echo Form::text('dob', null, array('class' => 'form-control dateonlypicker')); ?>

		    </div>
		    
		    <div class="form-group">
		        <?php echo Form::label('phone', 'Phone'); ?>

		        <?php echo Form::text('phone', null, array('class' => 'form-control')); ?>

		    </div>
		    
		    <?php if(Auth::user()->hasRole(['Superadmin', 'Admin']) && Auth::user()->id != $user->id): ?>
		    	<div class="form-group">
		    		<?php echo Form::label('roled_id', 'Role'); ?><br>
		    		<?php echo Form::select('role_id', array(
				    	'1' => 'Customer',
				    	'2' => Config::get('site.rep_title'),
				    	'3' => 'Editor',
				    	'4' => 'Admin'
				    ), null, array('class' => 'selectpicker')); ?>

			    </div>
		    
			    <div class="form-group dropdown" ng-class="check_sponsor()">
			        <?php echo Form::label('sponsor_id', 'Sponsor Id'); ?>

                    <?php echo Form::text('sponsor_id', null, array('ng-model'=>'sponsor','option'=>'users','item'=>'sponsor','class' => 'form-control autoComplete dropdown-toggle','url'=>'/api/search-user/','id'=>'dropdownMenu1','data-toggle'=>'dropdown','aria-expanded'=>'true')); ?>

                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" >
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="#" ng-click="update_sponsor(user)"  ng-repeat="user in users">{{user.name}}</a></li>
                    </ul>
			    </div>
			    
                <div class="form-group" ng-show="showName()">
                    <?php echo Form::label('sponsor_name', 'Sponsor Name'); ?>

                    <div>{{sponsor_name}}</div>
                </div>
			    
			    <!-- <div class="form-group">
			        <?php echo Form::label('mobile_plan_id', 'Mobile Plan Id'); ?>

			        <?php echo Form::text('mobile_plan_id', null, array('class' => 'form-control')); ?>

			    </div>
			    
			    <div class="form-group">
			        <?php echo Form::label('min_commission', 'Min Commission'); ?>

			        <?php echo Form::text('min_commission', null, array('class' => 'form-control')); ?>

			    </div>
			   -->
			    <div class="form-group">
			        <?php echo Form::label('disabled', 'Status'); ?>

			        <br>
			    	<?php echo Form::select('disabled', [
			    		0 => 'Active',
			    		1 => 'Disabled'
			    	], $user->disabled, ['class' => 'selectpicker']); ?>

			    </div>
			    
			<?php endif; ?>		    
		
		    <?php echo Form::submit('Update', array('class' => 'btn btn-primary')); ?>

		
		    <?php echo Form::close(); ?>

		</div>
	</div>
</div>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('scripts'); ?>
<script>
    var app = angular.module('app', []);
    app.service("shared", function($http, $q){
        var isLoading = false;
        var requestPromise = null;
        var requestData = function(url){
            isLoading = true;
            var canceller = $q.defer();

            var request = $http.get(url, { timeout: canceller.promise});
            
            var promise = request.then(
                function( response ) {
                    isLoading = false;
                    return( response.data );
                },
                function( response ) {
                    return( $q.reject( "Something went wrong" ) );
                }
            );
            
            promise.abort = function() {
                isLoading = false;
                if(canceller){
                    canceller.resolve();
                }
            };
            
            promise.finally(
                function() {
                    //console.log( "Cleaning up object references." );
                    canceller = request = promise = null;
                }
            );
            
            return( promise );
            
        };

        return {
            getIsLoading: function () {
                return isLoading;
            },
            requestPromise :requestPromise,
            requestData : requestData
        };
    });
    app.directive('autoComplete', ['$http','shared',function($http,shared) {
        
        return {
            restrict:'AEC',
            scope:{
                data: '=item',
                list: '=option'
            },
            link:function(scope,elem,attrs){
                scope.$watch('data', function(val){
                    if(val != undefined && val.length >= 2){                       
                        if(shared.requestPromise && shared.getIsLoading()){
                            shared.requestPromise.abort();    
                        }
                        shared.requestPromise = shared.requestData(attrs.url+scope.data);
                        shared.requestPromise.then(function(v){
                            scope.list = v.data;    
                        })
                    }
                });
            }
        }
    }]);
    
    function UserController($scope, shared){
        $scope.sponsor_name = "";
        $scope.sponsor = "";
        $scope.update_sponsor = function(user){
            $scope.sponsor = user.id;
            $scope.sponsor_name = user.name; 
        };
        
        $scope.check_sponsor = function(){
            if($scope.sponsor.length > 1){
                return "open";
            }else{
                $scope.sponsor_name = "";
                return false;
            }
        };
        
        $scope.showName = function(){
            if($scope.sponsor.length > 1 && $scope.sponsor_name !== ""){
                return true;
            }else return false; 
        };
    }
</script>
<?php $__env->stopSection(); ?>    

<?php echo $__env->make('layouts.default', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>